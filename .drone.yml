workspace:
  base: /go
  path: src/github.com/avesanen/dropdead

pipeline:
  build:
    image: golang:1.8.3
    environment: 
      - TMPDIR=/tmp
    commands:
      - go get .
      - go build
      - go get -t
      - go test -v

deploy:
  ssh:
    host: matrix.glitch.fi
    user: avesanen
    port: 22
    commands:
      - cd ~/go/src/github.com/avesanen/dropdead
      - git pull
      - docker-compose build
      - docker-compose up -d
